---
title: "Sankey diagrams for Bacteria and antibiotics"
author: "Kapil Khanal"
date: 2019-08-29T21:13:14-05:00
categories: ["R","ggplot2"]
tags: ["ggplot2", "Data Visualization", "Data Communication"]
---



<div id="visually-classifying-bacteria-and-antibiotics" class="section level2">
<h2>Visually Classifying Bacteria and Antibiotics</h2>
<p>After World War II, antibiotics earned the moniker “wonder drugs” for quickly treating previously-incurable diseases. Data was gathered to determine which drug worked best for each bacterial infection. Comparing drug performance was an enormous aid for practitioners and scientists alike. In the fall of 1951, Will Burtin published a <a href = "https://mbostock.github.io/protovis/ex/antibiotics-burtin.html">graph </a> showing the effectiveness of three popular antibiotics on <B>16</B> different bacteria, measured in terms of minimum inhibitory concentration.
Let’s bring the datasets,</p>
<pre><code>## ── Attaching packages ─────────────────────────────────────────────────────────── tidyverse 1.2.1 ──</code></pre>
<pre><code>## ✔ ggplot2 3.2.0     ✔ purrr   0.3.2
## ✔ tibble  2.1.3     ✔ dplyr   0.8.3
## ✔ tidyr   0.8.3     ✔ stringr 1.4.0
## ✔ readr   1.3.1     ✔ forcats 0.4.0</code></pre>
<pre><code>## Warning: package &#39;ggplot2&#39; was built under R version 3.5.2</code></pre>
<pre><code>## Warning: package &#39;tibble&#39; was built under R version 3.5.2</code></pre>
<pre><code>## Warning: package &#39;tidyr&#39; was built under R version 3.5.2</code></pre>
<pre><code>## Warning: package &#39;purrr&#39; was built under R version 3.5.2</code></pre>
<pre><code>## Warning: package &#39;dplyr&#39; was built under R version 3.5.2</code></pre>
<pre><code>## Warning: package &#39;stringr&#39; was built under R version 3.5.2</code></pre>
<pre><code>## Warning: package &#39;forcats&#39; was built under R version 3.5.2</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()</code></pre>
<pre><code>## Warning: package &#39;knitr&#39; was built under R version 3.5.2</code></pre>
<pre><code>## Warning: package &#39;kableExtra&#39; was built under R version 3.5.2</code></pre>
<pre><code>## 
## Attaching package: &#39;kableExtra&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     group_rows</code></pre>
<pre class="r"><code>kable(head(df,n = 16))</code></pre>
<table>
<thead>
<tr>
<th style="text-align:left;">
Bacteria
</th>
<th style="text-align:right;">
Penicillin
</th>
<th style="text-align:right;">
Streptomycin
</th>
<th style="text-align:right;">
Neomycin
</th>
<th style="text-align:left;">
Gram
</th>
<th style="text-align:right;">
ID
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Mycobacterium tuberculosis
</td>
<td style="text-align:right;">
800.000
</td>
<td style="text-align:right;">
5.00
</td>
<td style="text-align:right;">
2.000
</td>
<td style="text-align:left;">
negative
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Salmonella schottmuelleri
</td>
<td style="text-align:right;">
10.000
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;">
0.090
</td>
<td style="text-align:left;">
negative
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
Proteus vulgaris
</td>
<td style="text-align:right;">
3.000
</td>
<td style="text-align:right;">
0.10
</td>
<td style="text-align:right;">
0.100
</td>
<td style="text-align:left;">
negative
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
Klebsiella pneumoniae
</td>
<td style="text-align:right;">
850.000
</td>
<td style="text-align:right;">
1.20
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:left;">
negative
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
Brucella abortus
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
2.00
</td>
<td style="text-align:right;">
0.020
</td>
<td style="text-align:left;">
negative
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
Pseudomonas aeruginosa
</td>
<td style="text-align:right;">
850.000
</td>
<td style="text-align:right;">
2.00
</td>
<td style="text-align:right;">
0.400
</td>
<td style="text-align:left;">
negative
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
Escherichia coli
</td>
<td style="text-align:right;">
100.000
</td>
<td style="text-align:right;">
0.40
</td>
<td style="text-align:right;">
0.100
</td>
<td style="text-align:left;">
negative
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
Salmonella (Eberthella) typhosa
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.40
</td>
<td style="text-align:right;">
0.008
</td>
<td style="text-align:left;">
negative
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
Aerobacter aerogenes
</td>
<td style="text-align:right;">
870.000
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1.600
</td>
<td style="text-align:left;">
negative
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
Brucella antracis
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:left;">
positive
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:left;">
Streptococcus fecalis
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
0.100
</td>
<td style="text-align:left;">
positive
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:left;">
Staphylococcus aureus
</td>
<td style="text-align:right;">
0.030
</td>
<td style="text-align:right;">
0.03
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:left;">
positive
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:left;">
Staphylococcus albus
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:right;">
0.10
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:left;">
positive
</td>
<td style="text-align:right;">
13
</td>
</tr>
<tr>
<td style="text-align:left;">
Streptococcus hemolyticus
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
14.00
</td>
<td style="text-align:right;">
10.000
</td>
<td style="text-align:left;">
positive
</td>
<td style="text-align:right;">
14
</td>
</tr>
<tr>
<td style="text-align:left;">
Streptococcus viridans
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
10.00
</td>
<td style="text-align:right;">
40.000
</td>
<td style="text-align:left;">
positive
</td>
<td style="text-align:right;">
15
</td>
</tr>
<tr>
<td style="text-align:left;">
Diplococcus pneumoniae
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
11.00
</td>
<td style="text-align:right;">
10.000
</td>
<td style="text-align:left;">
positive
</td>
<td style="text-align:right;">
16
</td>
</tr>
</tbody>
</table>
<p>Before proceeding further with the data manipulation we need to think about the format of the visualization. Here we will be making our visualization on the bacteria level, that means we will have information for each bacteria, their gram stain , and the concentration of drug required .</p>
<p>If you look at the table above, we do have all the data we need but not on the format we are thinking. We want one information per row for each bacteria unlike above where each row has all the information of each bacteria on one single row.
Let’s change the format of the data,</p>
<pre class="r"><code>key_value = df %&gt;% gather(&quot;Drug&quot;,&quot;Concentration&quot;,Penicillin:Neomycin,-Bacteria)
kable(head(key_value))</code></pre>
<table>
<thead>
<tr>
<th style="text-align:left;">
Bacteria
</th>
<th style="text-align:left;">
Gram
</th>
<th style="text-align:right;">
ID
</th>
<th style="text-align:left;">
Drug
</th>
<th style="text-align:right;">
Concentration
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Mycobacterium tuberculosis
</td>
<td style="text-align:left;">
negative
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
Penicillin
</td>
<td style="text-align:right;">
800
</td>
</tr>
<tr>
<td style="text-align:left;">
Salmonella schottmuelleri
</td>
<td style="text-align:left;">
negative
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Penicillin
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:left;">
Proteus vulgaris
</td>
<td style="text-align:left;">
negative
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Penicillin
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
Klebsiella pneumoniae
</td>
<td style="text-align:left;">
negative
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Penicillin
</td>
<td style="text-align:right;">
850
</td>
</tr>
<tr>
<td style="text-align:left;">
Brucella abortus
</td>
<td style="text-align:left;">
negative
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Penicillin
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Pseudomonas aeruginosa
</td>
<td style="text-align:left;">
negative
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
Penicillin
</td>
<td style="text-align:right;">
850
</td>
</tr>
</tbody>
</table>
<p>okay so, now what we need to do is add a minimum concentration information for each bacteria for each stain type. so basically a column on the gathered table above</p>
</div>
